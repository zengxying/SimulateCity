{"version":3,"sources":["file:///D:/cocos_work/SimulateCity/assets/src/framework/resourceUtil.ts"],"names":["_decorator","Prefab","SpriteFrame","resources","error","Texture2D","instantiate","isValid","find","ccclass","ResourceUtil","loadRes","url","type","cb","load","err","res","message","loadEffectRes","modulePath","Promise","resolve","reject","prefab","console","loadModelRes","loadModelResArr","path","arrName","progressCb","completeCb","arrUrls","map","item","loadSpriteFrameRes","img","texture","image","sf","getMap","level","levelStr","txtAsset","content","_file","window","decompressFromEncodedURIComponent","objJson","JSON","parse","text","json","getMapObj","idx","length","push","getUIPrefabRes","prefabPath","createUI","parent","node","setPosition","addChild","getJsonData","fileName","getTextData","setSpriteFrame","sprite","spriteFrame"],"mappings":"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","sourcesContent":["import { _decorator, Prefab, Node, SpriteComponent, SpriteFrame, ImageAsset, resources, error, Texture2D, instantiate, isValid, find, TextAsset, JsonAsset } from \"cc\";\r\nconst { ccclass } = _decorator;\r\n\r\n@ccclass(\"ResourceUtil\")\r\nexport class ResourceUtil {\r\n    /**\r\n     * 加载资源\r\n     * @param url   资源路径\r\n     * @param type  资源类型\r\n     * @param cb    回调\r\n     * @method loadRes\r\n     */\r\n    public static loadRes (url: string, type: any, cb: Function = () => {}) {\r\n        resources.load(url, (err: any, res: any) => {\r\n            if (err) {\r\n                error(err.message || err);\r\n                cb(err, res);\r\n                return;\r\n            }\r\n\r\n            cb && cb(null, res);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取特效prefab\r\n     * @param modulePath 路径\r\n     * @returns\r\n     */\r\n    public static loadEffectRes (modulePath: string) {\r\n        return new Promise((resolve, reject) => {\r\n            this.loadRes(`prefab/effect/${modulePath}`, Prefab, (err: any, prefab: Prefab) => {\r\n                if (err) {\r\n                    console.error('effect load failed', modulePath);\r\n                    reject && reject();\r\n                    return;\r\n                }\r\n\r\n                resolve && resolve(prefab);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取模型数据\r\n     * @param modulePath 模型路径\r\n     * @returns\r\n     */\r\n    public static loadModelRes (modulePath: string) {\r\n        return new Promise((resolve, reject) => {\r\n            this.loadRes(`prefab/model/${modulePath}`, Prefab, (err: any, prefab: Prefab) => {\r\n                if (err) {\r\n                    console.error(\"model load failed\", modulePath);\r\n                    reject && reject();\r\n                    return;\r\n                }\r\n\r\n                resolve && resolve(prefab);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取多模型数据\r\n     * @param path 资源路径\r\n     * @param arrName 资源名称\r\n     * @param progressCb 过程回调函数\r\n     * @param completeCb 完成回调函数\r\n     */\r\n    public static loadModelResArr (path: string, arrName: Array<string>, progressCb: any, completeCb: any) {\r\n        let arrUrls = arrName.map((item) => {\r\n            return `${path}/${item}`;\r\n        });\r\n\r\n        resources.load(arrUrls, Prefab, progressCb, completeCb);\r\n    }\r\n\r\n    /**\r\n     * 获取贴图资源\r\n     * @param path 贴图路径\r\n     * @returns\r\n     */\r\n    public static loadSpriteFrameRes (path: string) {\r\n        return new Promise((resolve, reject) => {\r\n            this.loadRes(path, SpriteFrame, (err: any, img: ImageAsset) => {\r\n                if (err) {\r\n                    console.error('spriteFrame load failed!', path, err);\r\n                    reject && reject();\r\n                    return;\r\n                }\r\n\r\n                let texture = new Texture2D();\r\n                texture.image = img;\r\n\r\n                let sf = new SpriteFrame();\r\n                sf.texture = texture;\r\n\r\n                resolve && resolve(sf);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取关卡数据\r\n     * @param level 关卡\r\n     * @param cb 回调函数\r\n     */\r\n    public static getMap (level: number, cb: Function) {\r\n        let levelStr: string = 'map';\r\n        // 前面补0\r\n        if (level >= 100) {\r\n            levelStr += level;\r\n        } else if (level >= 10) {\r\n            levelStr += '0' + level;\r\n        } else {\r\n            levelStr += '00' + level;\r\n        }\r\n\r\n        this.loadRes(`map/config/${levelStr}`, null, (err: {}, txtAsset: any) => {\r\n            if (err) {\r\n                cb(err, txtAsset);\r\n                return;\r\n            }\r\n\r\n            let content: string = '';\r\n            if (txtAsset._file) {\r\n                // @ts-ignore\r\n                if (window['LZString']) {\r\n                    // @ts-ignore\r\n                    content = window['LZString'].decompressFromEncodedURIComponent(txtAsset._file);\r\n                }\r\n                var objJson = JSON.parse(content);\r\n                cb(null, objJson);\r\n            } else if (txtAsset.text) {\r\n                // @ts-ignore\r\n                if (window['LZString']) {\r\n                    // @ts-ignore\r\n                    content = window['LZString'].decompressFromEncodedURIComponent(txtAsset.text);\r\n                }\r\n                var objJson = JSON.parse(content);\r\n                cb(null, objJson);\r\n            } else if (txtAsset.json) {\r\n                cb(null, txtAsset.json);\r\n            } else {\r\n                cb('failed');\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取关卡数据\r\n     * @param type 关卡类型\r\n     * @param arrName 资源名称\r\n     * @param progressCb 过程回调函数\r\n     * @param completeCb 完成回调函数\r\n     */\r\n    public static getMapObj (type: string, arrName: Array<string>, progressCb?:any, completeCb?:any) {\r\n        let arrUrls: string[] = [];\r\n        for (let idx = 0; idx < arrName.length; idx++) {\r\n            arrUrls.push(`map/${type}/${arrName[idx]}`);\r\n        }\r\n\r\n        resources.load(arrUrls, Prefab, progressCb, completeCb);\r\n    }\r\n\r\n    /**\r\n     * 获取UI prefab\r\n     * @param prefabPath prefab路径\r\n     * @param cb 回调函数\r\n     */\r\n    public static getUIPrefabRes (prefabPath: string, cb?: Function) {\r\n        this.loadRes(\"prefab/ui/\" + prefabPath, Prefab, cb);\r\n    }\r\n\r\n    /**\r\n     * 创建ui界面\r\n     * @param path ui路径\r\n     * @param cb 回调函数\r\n     * @param parent 父节点\r\n     */\r\n    public static createUI (path: string, cb?: Function, parent?: Node) {\r\n        this.getUIPrefabRes(path, function (err: {}, prefab: Prefab) {\r\n            if (err) return;\r\n            let node: Node = instantiate(prefab);\r\n            node.setPosition(0, 0, 0);\r\n            if (!parent) {\r\n                parent = find(\"Canvas\") as Node;\r\n            }\r\n\r\n            parent.addChild(node);\r\n            cb && cb(null, node);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取json数据\r\n     * @param fileName 文件名\r\n     * @param cb 回调函数\r\n     */\r\n    public static getJsonData (fileName: string, cb: Function) {\r\n        this.loadRes(\"datas/\" + fileName, null, function (err: any, content: JsonAsset) {\r\n            if (err) {\r\n                error(err.message || err);\r\n                return;\r\n            }\r\n\r\n            if (content.json) {\r\n                cb(err, content.json);\r\n            } else {\r\n                cb('failed!!!');\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 获取文本数据\r\n     * @param fileName 文件名\r\n     * @param cb  回调函数\r\n     */\r\n    public static getTextData (fileName:string, cb: Function) {\r\n        this.loadRes(\"datas/\" + fileName, null, function (err: any, content: TextAsset) {\r\n            if (err) {\r\n                error(err.message || err);\r\n                return;\r\n            }\r\n\r\n            let text: string = content.text;\r\n            cb(err, text);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 设置精灵贴图\r\n     * @param path 资源路径\r\n     * @param sprite 精灵\r\n     * @param cb 回调函数\r\n     */\r\n    public static setSpriteFrame (path: string, sprite: SpriteComponent, cb?: Function) {\r\n        this.loadRes(path + '/spriteFrame', SpriteFrame, (err: any, spriteFrame: SpriteFrame) => {\r\n            if (err) {\r\n                console.error('set sprite frame failed! err:', path, err);\r\n                cb && cb(err);\r\n                return;\r\n            }\r\n\r\n            if (sprite && isValid(sprite)) {\r\n                sprite.spriteFrame = spriteFrame;\r\n                cb && cb(null);\r\n            }\r\n        });\r\n    }\r\n}\r\n"]}