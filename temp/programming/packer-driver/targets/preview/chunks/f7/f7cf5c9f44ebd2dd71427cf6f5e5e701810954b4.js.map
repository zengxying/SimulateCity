{"version":3,"sources":["file:///D:/cocos_work/games/SimulateCity/assets/src/component/OperateComp.ts"],"names":["_decorator","Component","Quat","Vec2","Vec3","Input","game","input","KeyCode","v2","GlobalConst","ccclass","property","v2_1","v2_2","v3_1","qt_1","forward","right","OperateComp","slide","range","rotaWheelSpeed","_euler","_velocity","_position","_speedScale","_eulerP","keys","moveDir","key2dirMap","onLoad","on","EventType","MOUSE_WHEEL","onMouseWheel","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","onDestroy","off","e","interruptOp","console","warn","log","getScrollX","getScrollY","delta","transformQuat","UNIT_Z","node","rotation","scaleAndAdd","position","getStartLocation","x","canvas","width","getDelta","y","rotateSpeed","z","event","keyCode","KEY_A","KEY_S","KEY_D","KEY_W","indexOf","push","updateDirection","KEY_Q","KEY_E","index","splice","update","dt","t","Math","min","damp","moveSpeed","lerp","getPosition","setPosition","lengthSqr","FORWARD","normalize","cross","UP","fromEuler","slerp","setWorldRotationFromEuler","keyCode0","length","keyCode1","dir"],"mappings":"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","sourcesContent":["import { _decorator, Component, Quat, Vec2, Vec3, Input, game, EventTouch, EventMouse, input, EventKeyboard, KeyCode, v2 } from 'cc';\r\nimport { GlobalConst } from '../GlobalConst';\r\nconst { ccclass, property } = _decorator;\r\n\r\nconst v2_1 = new Vec2();\r\nconst v2_2 = new Vec2();\r\nconst v3_1 = new Vec3();\r\nconst qt_1 = new Quat();\r\nconst forward = new Vec3();\r\nconst right = new Vec3();\r\n\r\n/**\r\n * \r\n11.双指缩放，旋转  同时触发 也就是说有距离移动就缩放，有方向变化就旋转\r\n\r\n1.建造物的拖拽\r\n2.从ui拖出一个建筑物\r\n3.建造物各种状态的实时切换，不能放置，等\r\n\r\n4.滑动和点击的区分，用于建造时是切换建造物的位置还是移动视野\r\n5.长按建造物触发建筑物位置切换操作\r\n6.点击ui触发ui事件\r\n7.如果建造物的ui是3d的ui是否可用于触摸点击  或者是2d的ui怎么处理变化\r\n8.产出物品的拾取\r\n9.建造物升级添加材料的操作\r\n10.建筑物的回收操作\r\n12.玩家不同的操作对于3d世界的影响，各种颜色变换滤镜等\r\n(1)可支持的3d场景面数，精细度\t\t\r\n(2)选中房屋拖动时 房屋类型的建筑物会保持原有颜色，其他地图物体变换成灰色 这块的处理规则那就是保持个类型建造的引用封装处理，也可以实现倒是\r\n(3)各种建筑物的状态，生产，还是定时开启等\r\n */\r\n\r\n@ccclass('OperateComp')\r\nexport class OperateComp extends Component {\r\n    \r\n    // 滚轮缩放的速度\r\n    rotaWheelSpeed: number = 0.1;\r\n\r\n\r\n    @property\r\n    public moveSpeed = 1;\r\n\r\n    @property\r\n    public moveSpeedShiftScale = 5;\r\n\r\n    @property({ slide: true, range: [0.05, 0.5, 0.01] })\r\n    public damp = 0.2;\r\n\r\n    @property\r\n    public rotateSpeed = 1;\r\n\r\n    private _euler = new Vec3();\r\n    private _velocity = new Vec3();\r\n    private _position = new Vec3();\r\n    private _speedScale = 1;\r\n    private _eulerP = new Vec3();\r\n    \r\n    public onLoad () {\r\n        input.on(Input.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\r\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        input.on(Input.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n\r\n\r\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n    }\r\n\r\n    public onDestroy () {\r\n        input.off(Input.EventType.MOUSE_WHEEL, this.onMouseWheel, this);\r\n        input.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        input.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        input.off(Input.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n\r\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\r\n    }\r\n\r\n\r\n    \r\n    public onMouseWheel (e: EventMouse) {\r\n        if(GlobalConst.interruptOp) return console.warn(\"中断操作中...............\");\r\n        console.log(`滚轮滚动的参数 getScrollX：${e.getScrollX()}  getScrollY:${e.getScrollY()}`)\r\n        const delta = -e.getScrollY() * this.rotaWheelSpeed * 0.1; // delta is positive when scroll down\r\n\r\n        // // 将数据放出去\r\n        Vec3.transformQuat(v3_1, Vec3.UNIT_Z, this.node.rotation);\r\n        Vec3.scaleAndAdd(this._position, this.node.position, v3_1, delta);\r\n    }\r\n    \r\n    public onTouchStart (e: EventTouch) {\r\n        console.log(\"ui  2d节点上的 触摸事件触发了  相机操作节点  --> TOUCH_START\")\r\n        if(GlobalConst.interruptOp) return console.warn(\"中断操作中...............\");\r\n        // if (game.canvas.requestPointerLock) { game.canvas.requestPointerLock(); }\r\n    }\r\n    \r\n    public onTouchMove (e: EventTouch) {\r\n        console.log(\"ui  2d节点上的 触摸事件触发了  相机操作节点  --> TOUCH_Move\")\r\n\r\n        if(GlobalConst.interruptOp) return console.warn(\"中断操作中...............\");\r\n        e.getStartLocation(v2_1);\r\n        if (v2_1.x > game.canvas.width * 0.4) { // rotation\r\n            e.getDelta(v2_2);\r\n            this._eulerP.y -= v2_2.x * this.rotateSpeed * 0.1;\r\n            this._eulerP.x += v2_2.y * this.rotateSpeed * 0.1;\r\n        } else { // position\r\n            e.getDelta(v2_2);\r\n            this._eulerP.y -= v2_2.x * this.rotateSpeed * 0.1;\r\n            this._eulerP.x += v2_2.y * this.rotateSpeed * 0.1;\r\n        }\r\n    }\r\n\r\n    public onTouchEnd (e: EventTouch) {\r\n        console.log(\"ui  2d节点上的 触摸事件触发了  相机操作节点  --> TOUCH_END\")\r\n\r\n        if(GlobalConst.interruptOp) return console.warn(\"中断操作中...............\");\r\n        // if (document.exitPointerLock) { document.exitPointerLock(); }\r\n        e.getStartLocation(v2_1);\r\n        if (v2_1.x < game.canvas.width * 0.4) { // position\r\n            this._velocity.x = 0;\r\n            this._velocity.z = 0;\r\n        }\r\n    }\r\n\r\n    private keys = [];\r\n    // x  -1 left, +1 right   y -1 backword, +1 forward\r\n    private moveDir:Vec3 = new Vec3();\r\n    onKeyDown(event:EventKeyboard){\r\n        if(GlobalConst.interruptOp) return console.warn(\"中断操作中...............\");\r\n\r\n        let keyCode = event.keyCode;\r\n        if(keyCode == KeyCode.KEY_A || keyCode == KeyCode.KEY_S || keyCode == KeyCode.KEY_D || keyCode == KeyCode.KEY_W){\r\n            if(this.keys.indexOf(keyCode) == -1){\r\n                this.keys.push(keyCode);\r\n                this.updateDirection();\r\n            }\r\n        }\r\n        if(keyCode == KeyCode.KEY_Q){\r\n            this.moveDir.y = -1;\r\n        }\r\n        else if(keyCode == KeyCode.KEY_E){\r\n            this.moveDir.y = 1;\r\n        }\r\n    }\r\n\r\n    onKeyUp(event:EventKeyboard){\r\n        if(GlobalConst.interruptOp) return console.warn(\"中断操作中...............\");\r\n\r\n        let keyCode = event.keyCode;\r\n        if(keyCode == KeyCode.KEY_A || keyCode == KeyCode.KEY_S || keyCode == KeyCode.KEY_D || keyCode == KeyCode.KEY_W){\r\n            let index = this.keys.indexOf(keyCode);\r\n            if(index != -1){\r\n                this.keys.splice(index,1);\r\n                this.updateDirection();\r\n            }\r\n        }\r\n\r\n        if(keyCode == KeyCode.KEY_Q || keyCode == KeyCode.KEY_E){\r\n            this.moveDir.y = 0;\r\n        }\r\n    }\r\n\r\n\r\n    public update (dt: number) {\r\n        const t = Math.min(dt / this.damp, 1);\r\n        // position\r\n        Vec3.transformQuat(v3_1, this._velocity, this.node.rotation);\r\n        Vec3.scaleAndAdd(this._position, this._position, v3_1, this.moveSpeed * this._speedScale);\r\n        Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\r\n        this.node.setPosition(v3_1);\r\n\r\n        if(this.moveDir.lengthSqr()){\r\n            Vec3.transformQuat(forward, Vec3.FORWARD, this.node.rotation);\r\n            forward.normalize();\r\n            Vec3.cross(right, forward, Vec3.UP);\r\n            right.normalize();\r\n\r\n            Vec3.scaleAndAdd(this._position, this._position, forward, this.moveSpeed * this._speedScale * this.moveDir.z);\r\n            Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\r\n            this.node.setPosition(v3_1);\r\n\r\n            Vec3.scaleAndAdd(this._position, this._position, right, this.moveSpeed * this._speedScale * this.moveDir.x);\r\n            Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\r\n            this.node.setPosition(v3_1);\r\n\r\n            Vec3.scaleAndAdd(this._position, this._position, Vec3.UP, this.moveSpeed * this._speedScale * this.moveDir.y);\r\n            Vec3.lerp(v3_1, this.node.getPosition(), this._position, t);\r\n            this.node.setPosition(v3_1);\r\n        }\r\n\r\n        // rotation\r\n        Quat.fromEuler(qt_1, this._eulerP.x, this._eulerP.y, this._eulerP.z);\r\n        Quat.slerp(qt_1, this.node.rotation, qt_1, t);\r\n        this.node.setWorldRotationFromEuler(this._eulerP.x, this._eulerP.y, this._eulerP.z);\r\n    }\r\n    \r\n    private key2dirMap = null;\r\n\r\n    updateDirection(){\r\n        if(this.key2dirMap == null){\r\n            this.key2dirMap = {};\r\n            this.key2dirMap[0] = v2(0,0);\r\n            this.key2dirMap[KeyCode.KEY_A] = v2(-1,0);\r\n            this.key2dirMap[KeyCode.KEY_D] = v2(1,0);\r\n            this.key2dirMap[KeyCode.KEY_W] = v2(0,1);\r\n            this.key2dirMap[KeyCode.KEY_S] = v2(0,-1);\r\n\r\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_A] = v2(-1,1);\r\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_D] = v2(1,1);\r\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_A] = v2(-1,-1);\r\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_D] = v2(1,-1);\r\n\r\n            this.key2dirMap[KeyCode.KEY_A * 1000 + KeyCode.KEY_D] = this.key2dirMap[KeyCode.KEY_D];\r\n            this.key2dirMap[KeyCode.KEY_D * 1000 + KeyCode.KEY_A] = this.key2dirMap[KeyCode.KEY_A];\r\n            this.key2dirMap[KeyCode.KEY_W * 1000 + KeyCode.KEY_S] = this.key2dirMap[KeyCode.KEY_S];\r\n            this.key2dirMap[KeyCode.KEY_S * 1000 + KeyCode.KEY_W] = this.key2dirMap[KeyCode.KEY_W];\r\n        }\r\n        let keyCode0 = this.keys[this.keys.length - 1] || 0;\r\n        let keyCode1 = this.keys[this.keys.length - 2] || 0;\r\n        let dir = this.key2dirMap[keyCode1 * 1000 + keyCode0];\r\n        this.moveDir.x = dir.x;\r\n        this.moveDir.z = dir.y;\r\n    }\r\n}\r\n"]}