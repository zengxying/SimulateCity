{"version":3,"sources":["file:///D:/cocos_work/SimulateCity/assets/src/framework/csvManager.ts"],"names":["_decorator","ccclass","property","CELL_DELIMITERS","LINE_DELIMITERS","getter","index","getterCast","value","cast","d","Array","Number","isNaN","CSV","STANDARD_DECODE_OPTS","skip","limit","header","comment","STANDARD_ENCODE_OPTS","delimiter","newline","quoteMark","doubleQuoteMark","quoteRegex","assign","args","prototype","slice","call","arguments","base","rest","i","len","length","attr","map","collection","fn","results","getType","obj","Object","toString","getLimit","buildObjectConstructor","fields","sample","object","setter","forEach","idx","buildArrayConstructor","row","frequency","coll","needle","count","lastIndex","maxIndex","indexOf","mostFrequent","needles","max","detected","cur","unsafeParse","text","opts","lines","split","splice","constructor","cells","line","shift","findIndex","list","item","quoteCount","start","end","key","hasOwnProperty","numKey","parseInt","substring","push","safeParse","encodeCells","replace","join","encodeArrays","lim","encodeObjects","key$1","parse","rows","bind","Math","min","floor","encode","CSVManager","_csvTables","_csvTableForArr","_tableCast","_tableComment","instance","_instance","addTable","tableName","tableContent","force","tableData","tableArr","keyName","getTableArr","getTable","queryOne","table","tbItem","queryByID","ID","queryAll","ret","queryIn","values","keys","queryByCondition","condition","tableKeys","tableKeysLength","keysLength","fit","j","queryOneByCondition"],"mappings":"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","sourcesContent":["import { _decorator } from \"cc\";\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nlet CELL_DELIMITERS = [\",\", \";\", \"\\t\", \"|\", \"^\"];\r\nlet LINE_DELIMITERS = [\"\\r\\n\", \"\\r\", \"\\n\"];\r\n\r\nlet getter = function (index: any) {\r\n    return (\"d[\" + index + \"]\");\r\n};\r\n\r\nlet getterCast = function(value: any, index: any, cast: any, d: any) {\r\n\r\n    if (cast instanceof Array) {\r\n        if (cast[index] === \"number\") {\r\n            return Number(d[index]);\r\n        } else if (cast[index] === \"boolean\") {\r\n            return d[index] === \"true\" || d[index] === \"t\" || d[index] === \"1\";\r\n        } else {\r\n            return d[index];\r\n        }\r\n    } else {\r\n        if (!isNaN(Number(value))) {\r\n            return Number(d[index]);\r\n        } else if (value == \"false\" || value == \"true\" || value == \"t\" || value == \"f\") {\r\n            return d[index] === \"true\" || d[index] === \"t\" || d[index] === \"1\";\r\n        } else {\r\n            return d[index];\r\n        }\r\n    }\r\n};\r\n\r\nlet CSV = {\r\n    //\r\n\r\n    /* =========================================\r\n        * Constants ===============================\r\n        * ========================================= */\r\n\r\n    STANDARD_DECODE_OPTS: {\r\n        skip: 0,\r\n        limit: false,\r\n        header: false,\r\n        cast: false,\r\n        comment: \"\"\r\n    },\r\n\r\n    STANDARD_ENCODE_OPTS: {\r\n        delimiter: CELL_DELIMITERS[0],\r\n        newline: LINE_DELIMITERS[0],\r\n        skip: 0,\r\n        limit: false,\r\n        header: false\r\n    },\r\n\r\n    quoteMark: '\"',\r\n    doubleQuoteMark: '\"\"',\r\n    quoteRegex: /\"/g,\r\n\r\n    /* =========================================\r\n        * Utility Functions =======================\r\n        * ========================================= */\r\n    assign: function () {\r\n        let args = Array.prototype.slice.call(arguments);\r\n        let base = args[0];\r\n        let rest = args.slice(1);\r\n        for (let i = 0, len = rest.length; i < len; i++) {\r\n            for (let attr in rest[i]) {\r\n                base[attr] = rest[i][attr];\r\n            }\r\n        }\r\n\r\n        return base;\r\n    },\r\n\r\n    map: function (collection: any, fn: Function) {\r\n        let results = [];\r\n        for (let i = 0, len = collection.length; i < len; i++) {\r\n            results[i] = fn(collection[i], i);\r\n        }\r\n\r\n        return results;\r\n    },\r\n\r\n    getType: function (obj: any) {\r\n        return Object.prototype.toString.call(obj).slice(8, -1);\r\n    },\r\n\r\n    getLimit: function (limit: any, len: any) {\r\n        return limit === false ? len : limit;\r\n    },\r\n\r\n    buildObjectConstructor: function(fields: any, sample: any, cast: any) {\r\n        return function(d: any) {\r\n            let object: any = new Object();\r\n            let setter = function(attr: any, value: any) {\r\n                return object[attr] = value;\r\n            };\r\n            if (cast) {\r\n                fields.forEach(function(attr: any, idx: number) {\r\n                    setter(attr, getterCast(sample[idx], idx, cast, d));\r\n                });\r\n            } else {\r\n                fields.forEach(function(attr: any, idx: number) {\r\n                    setter(attr, getterCast(sample[idx], idx, null, d));\r\n                });\r\n            }\r\n            // body.push(\"return object;\");\r\n            // body.join(\";\\n\");\r\n            return object;\r\n        };\r\n    },\r\n\r\n    buildArrayConstructor: function(fields: any, sample: any, cast: any) {\r\n        return function(d: any) {\r\n            let row = new Array(sample.length);\r\n            let setter = function(idx: any, value: any) {\r\n                return row[idx] = value;\r\n            };\r\n            if (cast) {\r\n                fields.forEach(function(attr: any, idx: number) {\r\n                    setter(attr, getterCast(sample[idx], idx, cast, d));\r\n                });\r\n            } else {\r\n                fields.forEach(function(attr: any, idx: number) {\r\n                    setter(attr, getterCast(sample[idx], idx, null, d));\r\n                });\r\n            }\r\n            return row;\r\n        };\r\n    },\r\n\r\n    frequency: function (coll: any, needle: any, limit: any) {\r\n        if (limit === void 0) limit = false;\r\n\r\n        let count = 0;\r\n        let lastIndex = 0;\r\n        let maxIndex = this.getLimit(limit, coll.length);\r\n\r\n        while (lastIndex < maxIndex) {\r\n            lastIndex = coll.indexOf(needle, lastIndex);\r\n            if (lastIndex === -1) break;\r\n            lastIndex += 1;\r\n            count++;\r\n        }\r\n\r\n        return count;\r\n    },\r\n\r\n    mostFrequent: function (coll: any, needles: any, limit: any) {\r\n        let max = 0;\r\n        let detected;\r\n\r\n        for (let cur = needles.length - 1; cur >= 0; cur--) {\r\n            if (this.frequency(coll, needles[cur], limit) > max) {\r\n                detected = needles[cur];\r\n            }\r\n        }\r\n\r\n        return detected || needles[0];\r\n    },\r\n\r\n    unsafeParse: function (text: any, opts: any, fn: any) {\r\n        let lines = text.split(opts.newline);\r\n\r\n        if (opts.skip > 0) {\r\n            lines.splice(opts.skip);\r\n        }\r\n\r\n        let fields;\r\n        let constructor;\r\n\r\n        function cells (lines: any) {\r\n            let line = lines.shift();\r\n            if (line.indexOf('\"') >= 0) { // 含引号\r\n\r\n                // 找到这行完整的数据, 找到对称的双引号\r\n                let lastIndex = 0;\r\n                let findIndex = 0;\r\n                let count = 0;\r\n                while (lines.length > 0) {\r\n                    lastIndex = line.indexOf('\"', findIndex);\r\n                    if (lastIndex === -1 && count % 2 === 0) break;\r\n\r\n                    if (lastIndex !== -1) {\r\n                        findIndex = lastIndex + 1;\r\n                        count++;\r\n                    } else {\r\n                        line = line + opts.newline + lines.shift();\r\n                    }\r\n                }\r\n\r\n                let list = [];\r\n                let item;\r\n\r\n                let quoteCount = 0;\r\n\r\n                let start = 0;\r\n                let end = 0;\r\n                let length = line.length;\r\n                for (let key in line) {\r\n                    if (!line.hasOwnProperty(key)) {\r\n                        continue;\r\n                    }\r\n\r\n                    let numKey = parseInt(key);\r\n                    let value = line[key];\r\n\r\n                    if (numKey === 0 && value === '\"') {\r\n                        quoteCount++;\r\n                        start = 1;\r\n                    }\r\n\r\n                    if (value === '\"') {\r\n                        quoteCount++;\r\n\r\n                        if (line[numKey - 1] === opts.delimiter && start === numKey) {\r\n                            start++;\r\n                        }\r\n                    }\r\n\r\n                    if (value === '\"' && quoteCount % 2 === 0) {\r\n\r\n                        if (line[numKey + 1] === opts.delimiter || numKey + 1 === length) {\r\n                            end = numKey;\r\n                            item = line.substring(start, end);\r\n                            list.push(item);\r\n                            start = end + 2;\r\n                            end = start;\r\n                        }\r\n\r\n                    }\r\n\r\n                    if (value === opts.delimiter && quoteCount % 2 === 0) {\r\n                        end = numKey;\r\n                        if (end > start) {\r\n                            item = line.substring(start, end);\r\n                            list.push(item);\r\n                            start = end + 1;\r\n                            end = start;\r\n                        } else if (end === start) {\r\n                            list.push(\"\");\r\n                            start = end + 1;\r\n                            end = start;\r\n                        }\r\n                    }\r\n\r\n                }\r\n\r\n                end = length;\r\n\r\n                if (end >= start) {\r\n                    item = line.substring(start, end);\r\n                    list.push(item);\r\n                }\r\n\r\n                return list;\r\n            } else {\r\n                return line.split(opts.delimiter);\r\n            }\r\n        }\r\n\r\n        if (opts.header) {\r\n            if (opts.header === true) {\r\n                opts.comment = cells(lines); // 第一行是注释\r\n                opts.cast = cells(lines); // 第二行是数据类型\r\n                fields = cells(lines);\r\n            } else if (this.getType(opts.header) === \"Array\") {\r\n                fields = opts.header;\r\n            }\r\n\r\n            constructor = this.buildObjectConstructor(fields, lines[0].split(opts.delimiter), opts.cast);\r\n        } else {\r\n            constructor = this.buildArrayConstructor(fields, lines[0].split(opts.delimiter), opts.cast);\r\n        }\r\n\r\n        while (lines.length > 0) {\r\n            let row = cells(lines);\r\n            if (row.length > 1) {\r\n                fn(constructor(row), fields[0]);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    safeParse: function (text: any, opts: any, fn: Function) {\r\n        let delimiter = opts.delimiter;\r\n        let newline = opts.newline;\r\n\r\n        let lines = text.split(newline);\r\n        if (opts.skip > 0) {\r\n            lines.splice(opts.skip);\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    encodeCells: function (line: any, delimiter: any, newline: any) {\r\n        let row = line.slice(0);\r\n        for (let i = 0, len = row.length; i < len; i++) {\r\n            if (row[i].indexOf(this.quoteMark) !== -1) {\r\n                row[i] = row[i].replace(this.quoteRegex, this.doubleQuoteMark);\r\n            }\r\n\r\n            if (row[i].indexOf(delimiter) !== -1 || row[i].indexOf(newline) !== -1) {\r\n                row[i] = this.quoteMark + row[i] + this.quoteMark;\r\n            }\r\n        }\r\n\r\n        return row.join(delimiter);\r\n    },\r\n\r\n    encodeArrays: function(coll: any, opts: any, fn: Function) {\r\n        let delimiter = opts.delimiter;\r\n        let newline = opts.newline;\r\n\r\n        if (opts.header && this.getType(opts.header) === \"Array\") {\r\n            fn(this.encodeCells(opts.header, delimiter, newline));\r\n        }\r\n\r\n        for (let cur = 0, lim = this.getLimit(opts.limit, coll.length); cur < lim; cur++) {\r\n            fn(this.encodeCells(coll[cur], delimiter, newline));\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    encodeObjects: function (coll: any, opts: any, fn:Function) {\r\n        let delimiter = opts.delimiter;\r\n        let newline = opts.newline;\r\n        let header;\r\n        let row;\r\n\r\n        header = [];\r\n        row = [];\r\n        for (let key in coll[0]) {\r\n            header.push(key);\r\n            row.push(coll[0][key]);\r\n        }\r\n\r\n        if (opts.header === true) {\r\n            fn(this.encodeCells(header, delimiter, newline));\r\n        } else if (this.getType(opts.header) === \"Array\") {\r\n            fn(this.encodeCells(opts.header, delimiter, newline));\r\n        }\r\n\r\n        // @ts-ignore\r\n        fn(this.encodeCells(row, delimiter));\r\n\r\n        for (let cur = 1, lim = this.getLimit(opts.limit, coll.length); cur < lim; cur++) {\r\n            row = [];\r\n            for (let key$1 = 0, len = header.length; key$1 < len; key$1++) {\r\n                row.push(coll[cur][header[key$1]]);\r\n            }\r\n\r\n            fn(this.encodeCells(row, delimiter, newline));\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    parse: function (text: any, opts: any, fn: Function) {\r\n        let rows: any;\r\n\r\n        if (this.getType(opts) === \"Function\") {\r\n            fn = opts;\r\n            opts = {};\r\n        } else if (this.getType(fn) !== \"Function\") {\r\n            rows = [];\r\n            fn = rows.push.bind(rows);\r\n        } else {\r\n            rows = [];\r\n        }\r\n\r\n        // @ts-ignore\r\n        opts = this.assign({}, this.STANDARD_DECODE_OPTS, opts);\r\n        // @ts-ignore\r\n        this.opts = opts;\r\n\r\n        if (!opts.delimiter || !opts.newline) {\r\n            let limit = Math.min(48, Math.floor(text.length / 20), text.length);\r\n            opts.delimiter = opts.delimiter || this.mostFrequent(text, CELL_DELIMITERS, limit);\r\n            opts.newline = opts.newline || this.mostFrequent(text, LINE_DELIMITERS, limit);\r\n        }\r\n\r\n        // modify by jl 由表自行控制不要含有双引号.提高解析效率\r\n        return this.unsafeParse(text, opts, fn) &&\r\n            (rows.length > 0 ? rows : true);\r\n    },\r\n\r\n    encode: function (coll: any, opts: any, fn: Function) {\r\n        let lines: any;\r\n\r\n        if (this.getType(opts) === \"Function\") {\r\n            fn = opts;\r\n            opts = {};\r\n        } else if (this.getType(fn) !== \"Function\") {\r\n            lines = [];\r\n            fn = lines.push.bind(lines);\r\n        }\r\n\r\n        // @ts-ignore\r\n        opts = this.assign({}, this.STANDARD_ENCODE_OPTS, opts);\r\n\r\n        if (opts.skip > 0) {\r\n            coll = coll.slice(opts.skip);\r\n        }\r\n\r\n        return (this.getType(coll[0]) === \"Array\" ? this.encodeArrays : this.encodeObjects)(coll, opts, fn) &&\r\n            (lines.length > 0 ? lines.join(opts.newline) : true);\r\n    }\r\n};\r\n\r\n@ccclass(\"CSVManager\")\r\nexport class CSVManager {\r\n    /* class member could be defined like this */\r\n\r\n    static _instance: CSVManager;\r\n\r\n    static get instance () {\r\n        if (this._instance) {\r\n            return this._instance;\r\n        }\r\n\r\n        this._instance = new CSVManager();\r\n        return this._instance;\r\n    }\r\n    private _csvTables:any = {};\r\n    private _csvTableForArr:any = {};\r\n    private _tableCast:any = {};\r\n    private _tableComment:any = {};\r\n\r\n    addTable (tableName:string, tableContent:string, force?:boolean) {\r\n        if (this._csvTables[tableName] && !force) {\r\n            return;\r\n        }\r\n        let tableData: any = {};\r\n        let tableArr: any[] = [];\r\n        let opts = { header: true };\r\n        CSV.parse(tableContent, opts, function (row: any, keyName: string) {\r\n            tableData[row[keyName]] = row;\r\n            tableArr.push(row);\r\n        });\r\n\r\n        this._tableCast[tableName] = (CSV as any).opts.cast;\r\n        this._tableComment[tableName] = (CSV as any).opts.comment;\r\n\r\n        this._csvTables[tableName] = tableData;\r\n        this._csvTableForArr[tableName] = tableArr;\r\n\r\n        // this.csvTables[tableName].initFromText(tableContent);\r\n    }\r\n\r\n    /**\r\n     * 根据表名获取表的所有内容\r\n     * @param {string} tableName  表名\r\n     * @returns {object} 表内容\r\n     */\r\n    getTableArr (tableName:string) {\r\n        return this._csvTableForArr[tableName];\r\n    }\r\n\r\n    /**\r\n     * 根据表名获取表的所有内容\r\n     * @param {string} tableName  表名\r\n     * @returns {object} 表内容\r\n     */\r\n    getTable (tableName:string) {\r\n        return this._csvTables[tableName];\r\n    }\r\n\r\n    /**\r\n     * 查询一条表内容\r\n     * @param {string} tableName 表名\r\n     * @param {string} key 列名\r\n     * @param {any} value 值\r\n     * @returns {Object} 一条表内容\r\n     */\r\n    queryOne (tableName:string, key:string, value:any) {\r\n        let table = this.getTable(tableName);\r\n        if (!table) {\r\n            return null;\r\n        }\r\n        if (key) {\r\n            for (let tbItem in table) {\r\n                if (!table.hasOwnProperty(tbItem)) {\r\n                    continue;\r\n                }\r\n\r\n                if (table[tbItem][key] === value) {\r\n                    return table[tbItem];\r\n                }\r\n            }\r\n        } else {\r\n            return table[value];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 根据ID查询一条表内容\r\n     * @param {string}tableName 表名\r\n     * @param {string}ID\r\n     * @returns {Object} 一条表内容\r\n     */\r\n    queryByID (tableName:string, ID:string) {\r\n        // @ts-ignore\r\n        return this.queryOne(tableName, null, ID);\r\n    }\r\n\r\n    /**\r\n     * 查询key和value对应的所有行内容\r\n     * @param {string} tableName 表名\r\n     * @param {string} key 列名\r\n     * @param {any} value 值\r\n     * @returns {Object}\r\n     */\r\n    queryAll (tableName:string, key:string, value:any) {\r\n        let table = this.getTable(tableName);\r\n        if (!table || !key) {\r\n            return null;\r\n        }\r\n\r\n        let ret: any = {};\r\n        for (let tbItem in table) {\r\n            if (!table.hasOwnProperty(tbItem)) {\r\n                continue;\r\n            }\r\n\r\n            if (table[tbItem][key] === value) {\r\n                ret[tbItem] = table[tbItem];\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    }\r\n\r\n    /**\r\n     * 选出指定表里所有 key 的值在 values 数组中的数据，返回 Object，key 为 ID\r\n     * @param {string} tableName 表名\r\n     * @param {string} key  列名\r\n     * @param {Array}values 数值\r\n     * @returns\r\n     */\r\n    queryIn (tableName:string, key:string, values:Array<any>) {\r\n        let table = this.getTable(tableName);\r\n        if (!table || !key) {\r\n            return null;\r\n        }\r\n\r\n        let ret: any = {};\r\n        let keys = Object.keys(table);\r\n        let length = keys.length;\r\n        for (let i = 0; i < length; i++) {\r\n            let item = table[keys[i]];\r\n            if (values.indexOf(item[key]) > -1) {\r\n                ret[keys[i]] = item;\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    }\r\n\r\n    /**\r\n     * 选出符合条件的数据。condition key 为表格的key，value 为值的数组。返回的object，key 为数据在表格的ID，value为具体数据\r\n     * @param {string} tableName 表名\r\n     * @param {any} condition 筛选条件\r\n     * @returns\r\n     */\r\n    queryByCondition (tableName:string, condition: any) {\r\n        if (condition.constructor !== Object) {\r\n            return null;\r\n        }\r\n\r\n        let table = this.getTable(tableName);\r\n        if (!table) {\r\n            return null;\r\n        }\r\n\r\n        let ret: any = {};\r\n        let tableKeys = Object.keys(table);\r\n        let tableKeysLength = tableKeys.length;\r\n        let keys = Object.keys(condition);\r\n        let keysLength = keys.length;\r\n        for (let i = 0; i < tableKeysLength; i++) {\r\n            let item = table[tableKeys[i]];\r\n            let fit = true;\r\n            for (let j = 0; j < keysLength; j++) {\r\n                let key = keys[j];\r\n                fit = fit && (condition[key] === item[key]) && !ret[tableKeys[i]];\r\n            }\r\n\r\n            if (fit) {\r\n                ret[tableKeys[i]] = item;\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    }\r\n\r\n    queryOneByCondition (tableName:string, condition: any) {\r\n        if (condition.constructor !== Object) {\r\n            return null;\r\n        }\r\n\r\n        let table = this.getTable(tableName);\r\n        if (!table) {\r\n            return null;\r\n        }\r\n\r\n        let keys = Object.keys(condition);\r\n        let keysLength = keys.length;\r\n\r\n        for (let keyName in table) {\r\n            let item = table[keyName];\r\n\r\n            let fit = true;\r\n            for (let j = 0; j < keysLength; j++) {\r\n                let key = keys[j];\r\n                fit = fit && (condition[key] === item[key]);\r\n            }\r\n\r\n            if (fit) {\r\n                return item;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n"]}