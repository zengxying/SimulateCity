{"version":3,"sources":["file:///D:/cocos_work/SimulateCity/assets/src/framework/localConfig.ts"],"names":["_decorator","resources","CSVManager","ResourceUtil","ccclass","property","LocalConfig","_csvManager","instance","_callback","Function","_currentLoad","_cntLoad","_instance","loadConfig","cb","_loadCSV","loadDir","err","assets","arrCsvFiles","filter","item","_native","length","forEach","index","array","getTextData","name","content","addTable","_tryToCallbackOnFinished","queryOne","tableName","key","value","queryByID","ID","getTable","getTableArr","queryAll","queryIn","values","queryByCondition","condition"],"mappings":"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","sourcesContent":["import { _decorator, resources } from \"cc\";\r\nimport { CSVManager } from \"./csvManager\";\r\nimport { ResourceUtil } from \"./resourceUtil\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"LocalConfig\")\r\nexport class LocalConfig {\r\n    /* class member could be defined like this */\r\n    private static _instance: LocalConfig;\r\n    private _csvManager: CSVManager = CSVManager.instance;\r\n\r\n    static get instance () {\r\n        if (this._instance) {\r\n            return this._instance;\r\n        }\r\n\r\n        this._instance = new LocalConfig();\r\n        return this._instance;\r\n    }\r\n\r\n    private _callback: Function = new Function();\r\n    private _currentLoad: number = 0;\r\n    private _cntLoad: number = 0;\r\n\r\n    /**\r\n     * 加载配置文件\r\n     * @param {Function}cb 回调函数\r\n     */\r\n    public loadConfig (cb: Function) {\r\n        this._callback = cb;\r\n        this._loadCSV();\r\n    }\r\n\r\n    private _loadCSV () {\r\n        // 新增数据表 请往该数组中添加....\r\n        resources.loadDir(\"datas\", (err: any, assets) => {\r\n            if (err) {\r\n                return;\r\n            }\r\n\r\n            let arrCsvFiles = assets.filter((item: any) => {\r\n                return item._native !== \".bat\" && item._native !== \".md\";\r\n            });\r\n\r\n            this._cntLoad = arrCsvFiles.length;\r\n\r\n            // 客户端加载\r\n            if (arrCsvFiles.length) {\r\n                arrCsvFiles.forEach((item, index, array) => {\r\n                    ResourceUtil.getTextData(item.name, (err: any, content: any) => {\r\n                        this._csvManager.addTable(item.name, content);\r\n                        this._tryToCallbackOnFinished();\r\n                    });\r\n                });\r\n            } else {\r\n                this._tryToCallbackOnFinished();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 查询一条表内容\r\n     * @param {string} tableName 表名\r\n     * @param {string} key 列名\r\n     * @param {any} value 值\r\n     * @returns {Object} 一条表内容\r\n     */\r\n    queryOne (tableName: string, key: string, value: any) {\r\n        return this._csvManager.queryOne(tableName, key, value);\r\n    }\r\n\r\n    /**\r\n     * 根据ID查询一条表内容\r\n     * @param {string}tableName 表名\r\n     * @param {string}ID\r\n     * @returns {Object} 一条表内容\r\n     */\r\n    queryByID (tableName: string, ID: string) {\r\n        return this._csvManager.queryByID(tableName, ID);\r\n    }\r\n\r\n    /**\r\n     * 根据表名获取表的所有内容\r\n     * @param {string} tableName  表名\r\n     * @returns {object} 表内容\r\n     */\r\n    getTable (tableName: string) {\r\n        return this._csvManager.getTable(tableName);\r\n    }\r\n\r\n    /**\r\n     * 根据表名获取表的所有内容\r\n     * @param {string} tableName  表名\r\n     * @returns {object} 表内容\r\n     */\r\n    getTableArr (tableName: string) {\r\n        return this._csvManager.getTableArr(tableName);\r\n    }\r\n\r\n    /**\r\n     * 查询key和value对应的所有行内容\r\n     * @param {string} tableName 表名\r\n     * @param {string} key 列名\r\n     * @param {any} value 值\r\n     * @returns {Object}\r\n     */\r\n    queryAll (tableName: string, key: string, value: any) {\r\n        return this._csvManager.queryAll(tableName, key, value);\r\n    }\r\n\r\n    //\r\n    /**\r\n     * 选出指定表里所有 key 的值在 values 数组中的数据，返回 Object，key 为 ID\r\n     * @param {string} tableName 表名\r\n     * @param {string} key  列名\r\n     * @param {Array}values 数值\r\n     * @returns\r\n     */\r\n    queryIn (tableName: string, key: string, values: any[]) {\r\n        return this._csvManager.queryIn(tableName, key, values);\r\n    }\r\n\r\n    /**\r\n     * 选出符合条件的数据。condition key 为表格的key，value 为值的数组。返回的object，key 为数据在表格的ID，value为具体数据\r\n     * @param {string} tableName 表名\r\n     * @param {any} condition 筛选条件\r\n     * @returns\r\n     */\r\n    queryByCondition (tableName: string, condition: any) {\r\n        return this._csvManager.queryByCondition(tableName, condition);\r\n    }\r\n\r\n    private _tryToCallbackOnFinished () {\r\n        if (this._callback) {\r\n            this._currentLoad++;\r\n            if (this._currentLoad >= this._cntLoad) {\r\n                this._callback();\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}